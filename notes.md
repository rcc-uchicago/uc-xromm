# Notes

The RCC will be hosting a testbed instance of the XMA Portal at `xromm.rcc.uchicago.edu`.  Kia will be accessing the testbed via `ssh` from IP address range `128.148.*` (`*.brown.edu`).

The XMA Portal source files are currently available in `xromm.rcc.uchicago.edu:/home/jvoigt/xma-portal-source`, which should be accessible to all RCC staff. Thatâ€™s actually a clone of Kia's bitbucket repo, so we can pull/update the source if Kia makes any changes.

The source is also available via [a private repo](https://github.com/rcc-uchicago/xma-portal).  Contact [@joyrexus](https://github.com/joyrexus) for access.


## The data pipeline

The Ross Lab is not going to be transferring files to Midway via the XMA Portal. Rather, they just want to update the portal's database once the files have been transferred.

The experimental data generated in the Ross Lab is set up to be [transferred to /synchronized with](rsync/README.md) a dedicated directory in the Ross Lab's project space (`project/rossc/lab/experiments`).  A cron job will be initiating the rsync on a nightly basis, using ssh keys generated by the Lab Admin (Taka) to access the remote machines in the Ross Lab.

#### A few thoughts on the file organization for XROMM experiments on Midway

The basic units of organization in the XMA Portal are **studies** and **trials**.  A
study (i.e., experiment) consists of one or more trials (i.e., series of
recorded observations).  A trial can be thought of as a particular "session" in the experiment.  Any given trial can consist of one or more files.

The directory layout for the Lab's dedicated project space for storing
experimental files should reflect this hierarchy by having **uniquely named
subdirectories for each study**, each containing **uniquely named subdirectories
for each trial**.

[Metadata](packaging.md) for each data file will be kept in `trial.json` and `study.json` within the corresponding subdirectories.


## XMA Portal API

We need a simple rest api for the portal's backend database for retrieving/creating/updating/deleting the portal's basic resources: users, studies, trials, files.

This will enable us to create purpose-specific clients for the portal, all using the same api: alternative web front-ends, CLIs, curl one-liners, etc.

For example, it would be handy to have the cron job that triggers the rsync to conclude with running a script that handles updating the portal database through the web api for any newly transferred files.

For example, imagine the [routes](http://en.wikipedia.org/wiki/Semantic_URL#Structure), where requests are made with [Basic Auth](http://en.wikipedia.org/wiki/Basic_access_authentication) headers for authentication and [form-encoded key-value pairs](http://en.wikipedia.org/wiki/Query_string#Structure) carrying the payload for POST requests:

    /api/studies (GET)
    /api/{study} (GET|POST)
    /api/{study}/trials (GET)
    /api/{study}/users (GET)
    /api/{study}/{user} (GET|POST)
    /api/{study}/{trial} (GET|POST)
    /api/{study}/{trial}/files (GET)
    /api/{study}/{trial}/{file} (GET|POST)

For form data / querystring construction, see node's [`querystring`](http://nodejs.org/api/querystring.html) module.  Various conventions exist for constructing/parsing more complex query strings.  See the [`qs`](https://github.com/hapijs/qs) module, which supports nesting.
